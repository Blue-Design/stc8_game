C51 COMPILER V9.60.0.0   LCD1602                                                           01/08/2021 01:23:25 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE LCD1602
OBJECT MODULE PLACED IN .\Out_File\lcd1602.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE ..\Device\lcd1602.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(..\Device;..\L
                    -ibraries) DEBUG OBJECTEXTEND PRINT(.\lcd1602.lst) OBJECT(.\Out_File\lcd1602.obj)

line level    source

   1          #include "lcd1602.h"
   2          
   3          //========================================================================
   4          // 描述: LCD1602读状态
   5          // 参数: none.
   6          // 返回: none.
   7          //========================================================================
   8          uint8 lcd1602_read_status()
   9          {
  10   1              LCD1602_Data = 0xFF; 
  11   1              LCD1602_RS = 0;
  12   1              LCD1602_RW = 1;
  13   1              LCD1602_E = 0;
  14   1              LCD1602_E = 0;
  15   1              LCD1602_E = 1;
  16   1              while (LCD1602_Data & LCD_BUSY); //检测忙信号
  17   1              return(LCD1602_Data);
  18   1      }
  19          
  20          //========================================================================
  21          // 描述: LCD1602写数据
  22          // 参数: dat:写的数据.
  23          // 返回: none.
  24          //========================================================================
  25          void lcd1602_write_data(uint8 dat)
  26          {
  27   1              LCD1602_E = 0;   
  28   1              LCD1602_RS = 1; 
  29   1              LCD1602_RW = 0; 
  30   1      
  31   1              LCD1602_Data = dat;     
  32   1              delay(1);
  33   1      
  34   1              LCD1602_E = 1;
  35   1              delay(5);
  36   1              LCD1602_E = 0;
  37   1      
  38   1              LCD1602_Data = dat << 4; 
  39   1              delay(1);
  40   1      
  41   1              LCD1602_E = 1;
  42   1              delay(5);
  43   1              LCD1602_E = 0;
  44   1      }
  45          
  46          //========================================================================
  47          // 描述: LCD1602写指令
  48          // 参数: com:写的指令.
  49          // 返回: none.
  50          //========================================================================
  51          void lcd1602_write_command(uint8 com)
  52          {
  53   1              LCD1602_E = 0;
  54   1              LCD1602_RS = 0; 
C51 COMPILER V9.60.0.0   LCD1602                                                           01/08/2021 01:23:25 PAGE 2   

  55   1              LCD1602_RW = 0;
  56   1      
  57   1              LCD1602_Data = com;     
  58   1              delay(1);
  59   1      
  60   1              LCD1602_E = 1;  
  61   1              delay(5);
  62   1              LCD1602_E = 0;
  63   1      
  64   1              LCD1602_Data = com << 4; 
  65   1              delay(1);
  66   1      
  67   1              LCD1602_E = 1;   
  68   1              delay(5);
  69   1              LCD1602_E = 0;
  70   1      }
  71          
  72          //========================================================================
  73          // 描述: LCD1602读数据
  74          // 参数: WCLCD:写的指令; LCD_BUSYC:0,忽略忙检测，1，需要忙检测.
  75          // 返回: none.
  76          //========================================================================
  77          uint8 lcd1602_read_data()
  78          {
  79   1              LCD1602_RS = 1; 
  80   1              LCD1602_RW = 1;
  81   1              LCD1602_E = 0;
  82   1              LCD1602_E = 0;
  83   1              LCD1602_E = 1;
  84   1              return(LCD1602_Data);
  85   1      }
  86          
  87          //========================================================================
  88          // 描述: 初始化LCD1602
  89          // 参数: none.
  90          // 返回: none.
  91          //========================================================================
  92          void lcd1602_init()
  93          {
  94   1              LCD1602_Data = 0;
  95   1          //引脚配置
  96   1          LCD1602_RS_OUT;
  97   1          LCD1602_RW_OUT;
  98   1          LCD1602_E_OUT;
  99   1          LCD1602_Data_OUT;
 100   1      
 101   1              lcd1602_write_command(0x38);    //三次模式设置，不检测忙信号
 102   1              delay(5);
 103   1              lcd1602_write_command(0x38);
 104   1              delay(5); 
 105   1              lcd1602_write_command(0x38);
 106   1              delay(5); 
 107   1      
 108   1              lcd1602_write_command(0x32);
 109   1              lcd1602_write_command(0x28);
 110   1              lcd1602_write_command(0x0C);
 111   1              lcd1602_write_command(0x06);
 112   1              lcd1602_write_command(0x01);
 113   1              lcd1602_write_command(0x80);
 114   1      }
 115          
 116          //========================================================================
C51 COMPILER V9.60.0.0   LCD1602                                                           01/08/2021 01:23:25 PAGE 3   

 117          // 描述: 在指定位置显示数字
 118          // 参数: x,y:坐标; Num:显示的数字; len:长度.
 119          // 返回: none.
 120          //========================================================================
 121          void lcd1602_clear()
 122          {
 123   1              lcd1602_write_command(0x01);
 124   1              delay(2); 
 125   1      } 
 126          
 127          //========================================================================
 128          // 描述: LCD1602按指定位置显示一个字符
 129          // 参数: x,y:坐标; c:显示的字符.
 130          // 返回: none.
 131          //========================================================================
 132          void lcd1602_show_char(uint8 x, uint8 y, char c)
 133          {
 134   1              y &= 0x1;
 135   1              x &= 0xF;                               //限制X不能大于15，Y不能大于1
 136   1              if (y) x |= 0x40;               //当要显示第二行时地址码+0x40;
 137   1              x |= 0x80;                          //算出指令码
 138   1              lcd1602_write_command(x);  //这里不检测忙信号，发送地址码
 139   1              lcd1602_write_data(c);
 140   1      }
 141          
 142          //========================================================================
 143          // 描述: LCD1602按指定位置显示一个字符串
 144          // 参数: x,y:坐标; str:显示的字符串.
 145          // 返回: none.
 146          //========================================================================
 147          void lcd1602_show_string(uint8 x, uint8 y, uint8 *str)
 148          {
 149   1              uint8 len,i;
 150   1      
 151   1              len = strlen(str);
 152   1              y &= 0x1;
 153   1              x &= 0xF;                               //限制X不能大于15，Y不能大于1
 154   1              
 155   1              for(i=0;i<len;i++)
 156   1              {
 157   2                      lcd1602_show_char(x,y,str[i]);
 158   2                      x++;
 159   2              }
 160   1      }
 161          
 162          //========================================================================
 163          // 描述: 在指定位置显示数字
 164          // 参数: x,y:坐标; num:显示的数字; 
 165          // 返回: none.
 166          //========================================================================
 167          void lcd1602_show_num(uint8 x,uint8 y,int num)
 168          {
 169   1              char men[15];
 170   1              char *str = men;
 171   1              sprintf(str,"%d",num);
 172   1              lcd1602_show_string(x,y,str);
 173   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    465    ----
   CONSTANT SIZE    =      3    ----
C51 COMPILER V9.60.0.0   LCD1602                                                           01/08/2021 01:23:25 PAGE 4   

   XDATA SIZE       =   ----      30
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
