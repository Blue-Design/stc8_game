C51 COMPILER V9.60.0.0   HC595                                                             01/08/2021 01:23:25 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE HC595
OBJECT MODULE PLACED IN .\Out_File\hc595.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE ..\Device\hc595.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(..\Device;..\Lib
                    -raries) DEBUG OBJECTEXTEND PRINT(.\hc595.lst) OBJECT(.\Out_File\hc595.obj)

line level    source

   1          #include "hc595.h"
   2          #include "delay.h"
   3          
   4          //位码
   5          code uint8 _595_bdata[8]={0x01,0x02,0x04,0x08,0x10,0x20,0x40,0x80};
   6          
   7          //========================================================================
   8          // 描述: 595初始化引脚.
   9          // 参数: none.
  10          // 返回: none.
  11          //========================================================================
  12          void hc595_init()
  13          {       
  14   1                      HC595_DS_MODE;        //引脚初始化
  15   1                      HC595_STCP_MODE;
  16   1                      HC595_SHCP_MODE;
  17   1      
  18   1                      HC595_DS = 0;
  19   1                      HC595_STCP = 0;
  20   1                      HC595_SHCP = 0;
  21   1      }
  22          
  23          //========================================================================
  24          // 描述: 595使能输出.
  25          // 参数: none.
  26          // 返回: none.
  27          //========================================================================
  28          void hc595_out_enable()
  29          {
  30   1          HC595_STCP = 0;
  31   1          delay10us();
  32   1          HC595_STCP = 1;
  33   1          delay10us();
  34   1          HC595_STCP = 0;
  35   1      }
  36          
  37          //========================================================================
  38          // 描述: 595发送8位数据.
  39          // 参数: 8位数据.
  40          // 返回: none.
  41          //========================================================================
  42          void hc595_send_byte(uint8 outdata)
  43          {
  44   1          uint8 i;
  45   1          for(i=0;i<8;i++)  //将8位数据按位发送，先发高字节再发低字节
  46   1              {      
  47   2              if((outdata&0x80)==0x80)
  48   2                  {
  49   3                  HC595_DS = 1;
  50   3              }
  51   2                  else
  52   2                  {
  53   3                  HC595_DS = 0;
  54   3              }
C51 COMPILER V9.60.0.0   HC595                                                             01/08/2021 01:23:25 PAGE 2   

  55   2              delay10us();
  56   2              HC595_SHCP = 0; //时钟线低电平
  57   2              delay10us();
  58   2              HC595_SHCP = 1; //时钟线高电平
  59   2              delay10us();
  60   2              outdata = outdata<<1;
  61   2          }
  62   1      }
  63          
  64          //========================================================================
  65          // 描述: 595发送数组.
  66          // 参数: 数组地址，数据长度.
  67          // 返回: none.
  68          //========================================================================
  69          void hc595_send_multi_byte(uint8 *ddata,uint16 len)
  70          {
  71   1          uint16 i;
  72   1          for(i=0;i<len;i++)
  73   1              {
  74   2              hc595_send_byte(ddata[i]);
  75   2          }
  76   1          hc595_out_enable();
  77   1      }
  78          
  79          //========================================================================
  80          // 描述: 595输出禁止.
  81          // 参数: 数组地址，数据长度.
  82          // 返回: none.
  83          //========================================================================
  84          void hc595_disable()
  85          {
  86   1          uint8 buf[2]={0,0};
  87   1          hc595_send_multi_byte(buf,2);
  88   1      }
  89          
  90          //========================================================================
  91          // 描述: 595使能数码管.
  92          // 参数: 数组地址，数据长度.
  93          // 返回: none.
  94          //========================================================================
  95          void hc595_enable_nix()
  96          {
  97   1          uint8 buf[2]={0,0xff};
  98   1          hc595_send_multi_byte(buf,2);
  99   1      }
 100          
 101          //========================================================================
 102          // 描述: 595使能点阵.
 103          // 参数: 数组地址，数据长度.
 104          // 返回: none.
 105          //========================================================================
 106          void hc595_enable_matrix()
 107          {
 108   1          uint8 buf[2]={0xff,0};
 109   1          hc595_send_multi_byte(buf,2);
 110   1      }
 111          
 112          //========================================================================
 113          // 描述: 595发送位选
 114          // 参数: (0~15)位.
 115          // 返回: none.
 116          //========================================================================
C51 COMPILER V9.60.0.0   HC595                                                             01/08/2021 01:23:25 PAGE 3   

 117          void hc595_bit_select(uint8 index)
 118          {
 119   1          //位选
 120   1          uint8 buf[2]={0,0};
 121   1          if(index>7)
 122   1          {
 123   2              buf[0]=_595_bdata[index-8];//COM8~COM15 点阵
 124   2          }
 125   1          else
 126   1          {
 127   2              buf[1]=_595_bdata[index];//COM0~COM7  数码管
 128   2          }
 129   1          
 130   1          hc595_send_multi_byte(buf,2);
 131   1      }
 132          
 133          //========================================================================
 134          // 描述: 595消影
 135          // 参数: none.
 136          // 返回: none.
 137          //========================================================================
 138          void hc595_bit_disable()
 139          {
 140   1          //位选
 141   1          uint8 buf[2]={0,0};
 142   1          hc595_send_multi_byte(buf,2);
 143   1      }
 144          
 145          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    387    ----
   CONSTANT SIZE    =     18    ----
   XDATA SIZE       =   ----      20
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
